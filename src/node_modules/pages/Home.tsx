import React,{useState} from 'react'
import { apiGet } from "misc/config"
import { useLastQuery } from "misc/custom-hook"
import { ActorProps } from "components/actor/ActorCard"
import { ShowProps } from "components/show/ShowCard"
import ShowList from "components/show/ShowList"
import ActorList from "components/actor/ActorList"
import MainPageLayout from "layout/MainPageLayout"
import { SearchButtonWrapper, SearchInput, RadioInputsWrapper } from "./Home.styled"
import CustomRadio from "../components/CustomRadio"

const Home = () => {
  const [input, setInput] = useLastQuery()
    const [movies, setMovies] = useState<any []>([])
    const [searchOption, setSearchOption] = useState('shows')

    const isShowsSearch = searchOption === "shows"

    const onInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
       setInput(e.target.value)
    }
    const onSearch = async () => {
        const result = await apiGet(`/search/${searchOption}?q=${input}`)
        setMovies(result)
    }
    const onKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {
        if (e.keyCode === 13) {
            onSearch()
        }
    }
    const onRadioChange = (e: React.ChangeEvent<HTMLInputElement>) => {
        setSearchOption(e.target.value)

    }
    const renderMovies = () => {

        if (movies && movies.length === 0) {
            return <div>no result</div>
        }
        if (movies && movies.length > 0) {
            return movies[0].show  ? <ShowList data={movies as ShowProps []} /> : <ActorList data={movies as ActorProps []}/>
        }
        return null
    }
  return (
    <MainPageLayout>
      <SearchInput type="text" onChange={onInputChange} value={input} onKeyDown={onKeyDown} />
          <RadioInputsWrapper>
              <div>
                  <CustomRadio id='shows-search' value="shows" checked={isShowsSearch} onChange={onRadioChange} label="shows" />

              </div>
              <div>
                   <CustomRadio id='actors-search'  value="people" checked={!isShowsSearch} onChange={onRadioChange} label="actors" />

              </div>


          </RadioInputsWrapper>
          <SearchButtonWrapper>
                  <button type='button' onClick={onSearch}>search</button>
          </SearchButtonWrapper>

          {renderMovies()}
    </MainPageLayout>
  )
}

export default Home