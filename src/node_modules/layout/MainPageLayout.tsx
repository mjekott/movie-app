import React, { useState } from 'react'
import { apiGet } from "misc/config"
import { ActorProps } from "components/actor/ActorCard"
import { ShowProps } from "components/show/ShowCard"
import ShowList from "components/show/ShowList"
import ActorList from "components/actor/ActorList"

type MainLayputProps = {
    children:React.ReactNode
}


const MainPageLayout = ({ children }: MainLayputProps) => {
    const [input, setInput] = useState("")
    const [movies, setMovies] = useState<ShowProps[] | ActorProps[]>([])
    const [searchOption, setSearchOption] = useState('shows')

    const isShowsSearch = searchOption === "shows"

    const onInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
       setInput(e.target.value)
    }
    const onSearch = async () => {
        const result = await apiGet(`/search/${searchOption}?q=${input}`)
        setMovies(result)
    }
    const onKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {
        if (e.keyCode === 13) {
            onSearch()
        }
    }
    const onRadioChange = (e: React.ChangeEvent<HTMLInputElement>) => {
        setSearchOption(e.target.value)

    }
    const renderMovies = () => {

        if (movies && movies.length === 0) {
            return <div>no result</div>
        }
        if (movies && movies.length > 0) {
            return movies[0]?.show  ? <ShowList data={movies as ShowProps []} /> : <ActorList data={movies as ActorProps []}/>
        }
        return null
    }

  return (
      <div>
          <input type="text" onChange={onInputChange} value={input} onKeyDown={onKeyDown} />
          <div>
              <label htmlFor="shows-search">shows <input id='shows-search' type="radio" value="shows" checked={isShowsSearch} onChange={onRadioChange} /></label>
              <label htmlFor="actors-search">actors <input id='actors-search' type="radio" value="people" checked={!isShowsSearch} onChange={onRadioChange} /></label>
          </div>
          <button type='button' onClick={onSearch}>search</button>
          {renderMovies()}
      </div>
  )
}

export default MainPageLayout